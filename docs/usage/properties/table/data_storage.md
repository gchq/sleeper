## Table Properties - Data Storage

The following table properties relate to the storage of data inside a table.

| Property Name                                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Default Value |
|----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| sleeper.table.rowgroup.size                              | Maximum number of bytes to write in a Parquet row group (defaults to value set in instance properties). This property is NOT used by DataFusion data engine.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 8388608       |
| sleeper.table.page.size                                  | The size of the page in the Parquet files - defaults to the value in the instance properties.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 131072        |
| sleeper.table.parquet.dictionary.encoding.rowkey.fields  | Whether dictionary encoding should be used for row key columns in the Parquet files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | false         |
| sleeper.table.parquet.dictionary.encoding.sortkey.fields | Whether dictionary encoding should be used for sort key columns in the Parquet files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | false         |
| sleeper.table.parquet.dictionary.encoding.value.fields   | Whether dictionary encoding should be used for value columns in the Parquet files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | false         |
| sleeper.table.parquet.columnindex.truncate.length        | Used to set parquet.columnindex.truncate.length, see documentation here:<br>https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/README.md<br>The length in bytes to truncate binary values in a column index.                                                                                                                                                                                                                                                                                                                                                                                                                     | 128           |
| sleeper.table.parquet.statistics.truncate.length         | Used to set parquet.statistics.truncate.length, see documentation here:<br>https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/README.md<br>The length in bytes to truncate the min/max binary values in row groups.                                                                                                                                                                                                                                                                                                                                                                                                              | 2147483647    |
| sleeper.table.datafusion.s3.readahead.enabled            | Enables a cache of data when reading from S3 with the DataFusion data engine, to hold data in larger blocks than are requested by DataFusion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | true          |
| sleeper.table.parquet.writer.version                     | Used to set parquet.writer.version, see documentation here:<br>https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/README.md<br>Can be either v1 or v2. The v2 pages store levels uncompressed while v1 pages compress levels with the data.                                                                                                                                                                                                                                                                                                                                                                                      | v2            |
| sleeper.table.parquet.query.column.index.enabled         | Used during Sleeper queries to determine whether the column/offset indexes (also known as page indexes) are read from Parquet files. For some queries, e.g. single/few row lookups this can improve performance by enabling more aggressive pruning. On range queries, especially on large tables this can harm performance, since readers will read the extra index data before returning results, but with little benefit from pruning.                                                                                                                                                                                                     | false         |
| sleeper.table.parquet.rowgroup.rows.max                  | Maximum number of rows to write in a Parquet row group.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 1000000       |
| sleeper.table.fs.s3a.readahead.range                     | The S3 readahead range - defaults to the row group size.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 8388608       |
| sleeper.table.compression.codec                          | The compression codec to use for this table. Defaults to the value in the instance properties.<br>Valid values are: [uncompressed, snappy, gzip, lzo, brotli, lz4, zstd]                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | zstd          |
| sleeper.table.gc.delay.minutes                           | A file will not be deleted until this number of minutes have passed after it has been marked as ready for garbage collection. The reason for not deleting files immediately after they have been marked as ready for garbage collection is that they may still be in use by queries. Defaults to the value set in the instance properties.                                                                                                                                                                                                                                                                                                    | 15            |
| sleeper.table.gc.commit.async                            | If true, deletion of files will be applied via asynchronous requests sent to the state store committer lambda. If false, the garbage collector lambda will apply synchronously.<br>This is only applied if async commits are enabled for the table. The default value is set in an instance property.                                                                                                                                                                                                                                                                                                                                         | true          |
| sleeper.table.retain.after.removal                       | This property is used when applying an instance configuration and a table has been removed.<br>If this is true (default), removing the table from the configuration will just take the table offline.<br>If this is false, it will delete all data associated with the table when the table is removed.<br>Be aware that if a table is renamed in the configuration, the CDK will see it as a delete of the old table name and a create of the new table name. If this is set to false when that happens it will remove the table's data.<br>This property isn't currently in use but will be in https://github.com/gchq/sleeper/issues/5870. | true          |
| sleeper.table.reuse.existing                             | This property is used when applying an instance configuration and a table has been added.<br>By default, or if this property is false, when a table is added to an instance configuration it's created in the instance. If it already exists the update will fail.<br>If this property is true, the existing table will be reused and imported as part of the instance configuration. If it doesn't exist the update will fail.                                                                                                                                                                                                               | false         |
